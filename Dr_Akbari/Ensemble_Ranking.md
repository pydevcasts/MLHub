## 📌 **فرمول رتبه‌بندی تجمیعی**

فرض کنیم:

* تعداد آیتم‌ها (گزینه‌ها) برابر با $n$ است: $i = 1, 2, \dots, n$
* تعداد مدل‌ها یا منابع رتبه‌بندی برابر با $m$ است: $j = 1, 2, \dots, m$
* $R_{ij}$ نمایانگر رتبهٔ آیتم $i$ توسط مدل $j$ است.

در ابتدا، سه شاخص کلیدی برای هر آیتم $i$ محاسبه می‌شود:

1. **میانگین رتبه (Average Rank):**

$$
\text{AvgRank}_i = \frac{1}{m} \sum_{j=1}^{m} R_{ij}
$$

2. **میانه رتبه (Median Rank):**

$$
\text{MedRank}_i = \text{Median}(\{R_{i1}, R_{i2}, \dots, R_{im}\})
$$

3. **امتیاز بوردا (Borda Score):**

   برای هر رتبه $r$، امتیاز آن برابر با $n - r$ است. بنابراین، مجموع امتیازات هر آیتم از مدل‌های مختلف به صورت زیر محاسبه می‌شود:

$$
\text{Borda}_i = \sum_{j=1}^{m} (n - R_{ij})
$$
### ✅ نرمال‌سازی مقادیر:

برای ترکیب شاخص‌ها، آن‌ها را در بازه‌ی \[0, 1] نرمال می‌کنیم:

$$
\text{NormAvg}_i = 1 - \frac{\text{AvgRank}_i - \min(\text{AvgRank})}{\max(\text{AvgRank}) - \min(\text{AvgRank})}
$$

$$
\text{NormMed}_i = 1 - \frac{\text{MedRank}_i - \min(\text{MedRank})}{\max(\text{MedRank}) - \min(\text{MedRank})}
$$

$$
\text{NormBorda}_i = \frac{\text{Borda}_i - \min(\text{Borda})}{\max(\text{Borda}) - \min(\text{Borda})}
$$

---

### 🏁 **فرمول نهایی رتبه ترکیبی (Final Ensemble Score):**

$$
\text{FinalScore}_i = \frac{1}{3} \left( \text{NormAvg}_i + \text{NormMed}_i + \text{NormBorda}_i \right)
$$

---

## 📝 توضیح برای ارائه مقاله

> در این پژوهش برای ترکیب چند رتبه‌بندی مختلف از مدل‌های مستقل، از یک فرمول **Ensemble Ranking** استفاده شده است که مبتنی بر سه شاخص آماری معتبر شامل میانگین رتبه، میانه رتبه و امتیاز بوردا است.
>
> هر کدام از این شاخص‌ها ابتدا محاسبه شده و سپس با نرمال‌سازی در بازه‌ی $[0, 1]$، قابل مقایسه و ترکیب می‌شوند.
>
> در نهایت با میانگین‌گیری ساده از سه مقدار نرمال‌شده، یک امتیاز نهایی برای هر آیتم تولید می‌شود که مبنای رتبه‌بندی نهایی است.
>
> این روش علاوه بر لحاظ کردن دیدگاه‌های مختلف مدل‌ها (مدل‌های یادگیری ماشین، یا معیارهای مختلف)، از نوسانات زیاد در داده‌ها جلوگیری کرده و به یک رتبه‌بندی پایدارتر و منصفانه‌تر منتهی می‌شود.

---

## 🎯 داده‌ها

### آیتم‌ها:

`A, B, C, D, E`

### 📊 رتبه‌ها از ۳ مدل مختلف:

| آیتم | مدل 1 | مدل 2 | مدل 3 |
| ---- | ----- | ----- | ----- |
| A    | 1     | 2     | 3     |
| B    | 2     | 1     | 1     |
| C    | 3     | 3     | 2     |
| D    | 4     | 5     | 4     |
| E    | 5     | 4     | 5     |

---

## ✅ مرحله ۱: محاسبه شاخص‌های پایه

### 1. **میانگین رتبه‌ها**:

$$
\text{Avg}(x) = \frac{x_1 + x_2 + x_3}{3}
$$

| آیتم | Avg  |
| ---- | ---- |
| A    | 2.00 |
| B    | 1.33 |
| C    | 2.67 |
| D    | 4.33 |
| E    | 4.67 |

---

### 2. **میانه رتبه‌ها (Median)**:

| آیتم | رتبه‌ها | Median |
| ---- | ------- | ------ |
| A    | 1, 2, 3 | 2      |
| B    | 1, 1, 2 | 1      |
| C    | 2, 3, 3 | 3      |
| D    | 4, 4, 5 | 4      |
| E    | 4, 5, 5 | 5      |

---

### 3. **امتیاز بوردا (Borda Score)**

طبق امتیاز معکوس رتبه‌ها:
(رتبه 1 → 5 امتیاز، رتبه 2 → 4، رتبه 3 → 3، رتبه 4 → 2، رتبه 5 → 1)

| آیتم | Borda          |
| ---- | -------------- |
| A    | 5 + 4 + 3 = 12 |
| B    | 4 + 5 + 5 = 14 |
| C    | 3 + 3 + 4 = 10 |
| D    | 2 + 1 + 2 = 5  |
| E    | 1 + 2 + 1 = 4  |

---

## ✅ مرحله ۲: نرمال‌سازی تمام معیارها

### نرمال‌سازی میانگین رتبه (معکوس):

$$
\text{NormAvg}(x) = 1 - \frac{x - 1.33}{4.67 - 1.33}
$$

| آیتم | Norm Avg |
| ---- | -------- |
| B    | 1.00     |
| A    | 0.78     |
| C    | 0.56     |
| D    | 0.10     |
| E    | 0.00     |

---

### نرمال‌سازی میانه رتبه (معکوس):

$$
\text{NormMedian}(x) = 1 - \frac{x - 1}{5 - 1}
$$

| آیتم | Median | Norm Median |
| ---- | ------ | ----------- |
| B    | 1      | 1.00        |
| A    | 2      | 0.75        |
| C    | 3      | 0.50        |
| D    | 4      | 0.25        |
| E    | 5      | 0.00        |

---

### نرمال‌سازی امتیاز بوردا:

$$
\text{NormBorda}(x) = \frac{x - 4}{14 - 4}
$$

| آیتم | Borda | Norm Borda |
| ---- | ----- | ---------- |
| B    | 14    | 1.00       |
| A    | 12    | 0.80       |
| C    | 10    | 0.60       |
| D    | 5     | 0.10       |
| E    | 4     | 0.00       |

---

## ✅ مرحله ۳: محاسبه امتیاز نهایی با فرمول ترکیبی

فرض می‌گیریم وزن مساوی برای همه معیارها:

$$
\text{Final Score} = \frac{1}{3}( \text{NormAvg} + \text{NormMedian} + \text{NormBorda})
$$

| آیتم | Final Score                       | رتبه نهایی |
| ---- | --------------------------------- | ---------- |
| B    | (1 + 1 + 1)/3 = **1.00**          | 🥇 رتبه 1  |
| A    | (0.78 + 0.75 + 0.80)/3 = **0.78** | 🥈 رتبه 2  |
| C    | (0.56 + 0.50 + 0.60)/3 = **0.55** | 🥉 رتبه 3  |
| D    | (0.10 + 0.25 + 0.10)/3 = **0.15** | رتبه 4     |
| E    | (0.00 + 0.00 + 0.00)/3 = **0.00** | رتبه 5     |

---

## ✅ جمع‌بندی فرمول نهایی

اگر بخوایم به‌صورت ریاضی بنویسیم:

$$
\text{FinalRankScore}_i = \frac{1}{3} \left( \text{NormAvg}_i + \text{NormMedian}_i + \text{NormBorda}_i \right)
$$

که برای هر آیتم $i$، نمره نهایی حاصل از ترکیب ۳ معیار مختلف به‌شکل نرمال‌شده است.

---
```python

import numpy as np
import pandas as pd


ranks = pd.DataFrame({
    "Model_A": [1, 2, 3, 4, 5],
    "Model_B": [2, 1, 3, 5, 4],
    "Model_C": [1, 2, 3, 4, 5]
}, index=["E1", "E2", "E3", "E4", "E5"])

# 1: mean 
ranks["avg_rank"] = ranks.mean(axis=1)

# 2: median
ranks["median_rank"] = ranks.median(axis=1)

# 3: Borda Count
max_rank = ranks.shape[0]
borda_score = (max_rank + 1 - ranks).sum(axis=1)
ranks["borda_rank"] = borda_score.rank(ascending=False)

# result
final = ranks.sort_values("borda_rank")
print(final[["avg_rank", "median_rank", "borda_rank"]])
```


### ✅ پیشنهاد روش نوین: **Adaptive Weighted Rank Aggregation (AWRA)**

#### 🎯 هدف:

ترکیب رتبه‌های چند منبع یا مدل مختلف به‌گونه‌ای که دقت، پایداری و انسجام رتبه نهایی افزایش یابد.

---

### 📌 گام‌های روش پیشنهادی:

1. **نرمال‌سازی رتبه‌ها:**
   تمام رتبه‌ها از منابع مختلف به مقیاس ۰ تا ۱ تبدیل می‌شوند (برای حذف تأثیر مقیاس‌ها).

2. **تحلیل همبستگی منابع رتبه‌دهنده:**
   میزان شباهت هر منبع به منابع دیگر با استفاده از *ضریب همبستگی کندال (Kendall’s Tau)* یا *Spearman* محاسبه می‌شود.

3. **وزن‌دهی تطبیقی به منابع:**
   منابعی که همبستگی بیشتری با دیگر منابع دارند، وزن بالاتری می‌گیرند. (یعنی منابعی که توافق بیشتری با سایر منابع دارند، معتبرتر تلقی می‌شوند.)

4. **محاسبه امتیاز نهایی برای هر آیتم (Ranking Score):**
   از ترکیب وزنی میانگین رتبه، میانه، و امتیاز بوردا برای هر آیتم استفاده می‌شود:

   $$
   \text{Score}_i = \alpha \cdot \text{WeightedMean}_i + \beta \cdot \text{WeightedMedian}_i + \gamma \cdot \text{Borda}_i
   $$

   که:

   * $\alpha + \beta + \gamma = 1$
   * وزن‌ها می‌توانند ثابت یا مبتنی بر یادگیری باشند.

5. **تحلیل پایداری رتبه‌ها (Stability Check):**
   با استفاده از تکنیک‌های bootstrapping یا حذف منابع، بررسی می‌شود که آیا رتبه‌ها پایدار هستند یا نه.

---

### ✅ نوآوری‌های این روش:

* ترکیب تطبیقی وزن‌ها با توجه به همبستگی منابع
* ادغام چند معیار کلاسیک (میانگین، میانه، بوردا)
* امکان به‌کارگیری در یادگیری تقویتی یا یادگیری نظارت‌شده برای تنظیم خودکار وزن‌ها


---

### 📊 جدول رتبه‌بندی اولیه:

| آیتم | مدل 1 | مدل 2 | مدل 3 |
| ---- | ----- | ----- | ----- |
| A    | 1     | 2     | 3     |
| B    | 2     | 1     | 1     |
| C    | 3     | 3     | 2     |
| D    | 4     | 5     | 4     |
| E    | 5     | 4     | 5     |

---

### ✅ گام ۱: نرمال‌سازی رتبه‌ها به بازه \[0, 1]

 نرمال‌سازی:



| آیتم | مدل 1 | مدل 2 | مدل 3 |
| ---- | ----- | ----- | ----- |
| A    | 0.00  | 0.25  | 0.50  |
| B    | 0.25  | 0.00  | 0.00  |
| C    | 0.50  | 0.50  | 0.25  |
| D    | 0.75  | 1.00  | 0.75  |
| E    | 1.00  | 0.75  | 1.00  |

---

### ✅ گام ۲: محاسبه همبستگی کندال بین مدل‌ها

برای ۵ آیتم، Kendall's Tau را بین مدل‌ها حساب می‌کنیم:

* بین مدل 1 و مدل 2: τ = 0.6
* بین مدل 1 و مدل 3: τ = 0.8
* بین مدل 2 و مدل 3: τ = 0.6

🔢 میانگین همبستگی:

| مدل   | τ میانگین           |
| ----- | ------------------- |
| مدل 1 | (0.6 + 0.8)/2 = 0.7 |
| مدل 2 | (0.6 + 0.6)/2 = 0.6 |
| مدل 3 | (0.8 + 0.6)/2 = 0.7 |

🔸 **نرمال‌سازی وزن‌ها:**

$$
\text{Total} = 0.7 + 0.6 + 0.7 = 2.0
\Rightarrow w_1 = 0.35,\quad w_2 = 0.30,\quad w_3 = 0.35
$$

---

### ✅ گام ۳: محاسبه رتبه ترکیبی با وزن‌دهی تطبیقی


$$
\text{WeightedScore i} = w_1 \times r_{1,i} + w_2 \times r_{2,i} + w_3 \times r_{3,i}
$$





| آیتم | محاسبه                                   | امتیاز ترکیبی |
| ---- | ---------------------------------------- | ------------- |
| A    | 0.35×0 + 0.30×0.25 + 0.35×0.5 = 0.2675   | **0.2675**    |
| B    | 0.35×0.25 + 0.30×0 + 0.35×0 = 0.0875     | **0.0875**    |
| C    | 0.35×0.5 + 0.30×0.5 + 0.35×0.25 = 0.4125 | **0.4125**    |
| D    | 0.35×0.75 + 0.30×1 + 0.35×0.75 = 0.8375  | **0.8375**    |
| E    | 0.35×1 + 0.30×0.75 + 0.35×1 = 0.925      | **0.925**     |

---

### 🏆 رتبه‌بندی نهایی با روش AWRA:

| رتبه | آیتم | امتیاز ترکیبی |
| ---- | ---- | ------------- |
| 1    | B    | 0.0875        |
| 2    | A    | 0.2675        |
| 3    | C    | 0.4125        |
| 4    | D    | 0.8375        |
| 5    | E    | 0.925         |

---

### 📈 مقایسه با میانگین ساده رتبه‌ها (بدون وزن):

| آیتم | میانگین نرمال شده            |
| ---- | ---------------------------- |
| A    | (0 + 0.25 + 0.5)/3 = 0.25    |
| B    | (0.25 + 0 + 0)/3 = 0.083     |
| C    | (0.5 + 0.5 + 0.25)/3 = 0.417 |
| D    | (0.75 + 1 + 0.75)/3 = 0.833  |
| E    | (1 + 0.75 + 1)/3 = 0.917     |

تقریباً همان ترتیب است، اما تفاوت‌ها در رتبه‌های نزدیک (A و C) با وزن‌دهی دقیق‌تر AWRA بهتر مدیریت شده‌اند.

---

